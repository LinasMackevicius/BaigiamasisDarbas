@page
@model projektas.Pages.Sessions.ActiveSessionModel
<link rel="stylesheet" href="~/css/styles.css" asp-append-version="true">
@{
    ViewData["Title"] = "Active Session";
}

<h2>Active Session</h2>

<form method="post" asp-page-handler="SaveSession" id="saveSessionForm">
    <div class="session-info">
        <h4>Session Information</h4>

        <div class="mb-3 col-12">
            <label for="date" class="form-label">Date</label>

            <!-- Hidden date picker input for selecting date -->
            <input type="date" asp-for="SessionDate" id="date" class="form-control" onchange="updateFormattedDate()" style="display: none;" />

            <!-- Read-only field to display the formatted date -->
            <input type="text" id="formattedDate" class="form-control w-50" readonly />

            <!-- Button to trigger the date picker calendar -->
            <button type="button" class="btn btn-light" onclick="document.getElementById('date').showPicker()">📅</button>
        </div>

        <div class="mb-3">
            <label asp-for="SessionType" class="form-label">Session Type</label>
            <select asp-for="SessionType" asp-items="Html.GetEnumSelectList<projektas.Models.SessionType>()" class="form-control w-50" required>
                <option value="">-- Select Session Type --</option>
            </select>
            <span asp-validation-for="SessionType" class="text-danger"></span>
        </div>
       
        @* User is able to pick a session time start *@
        <div class="mb-3">
            <label asp-for="TimeOfADayStart" class="form-label">Select Time Of A Day</label>
            <input type="time" asp-for="TimeOfADayStart" class="form-control w-50" step="60" required />
            <span asp-validation-for="TimeOfADayStart" class="text-danger"></span>
        </div>

        <div class="mb-3 col-12">
            <label for="place" class="form-label">Location</label>
            <input type="text" id="place" asp-for="Place" class="form-control w-50" placeholder="Enter location" required />
        </div>

        <div class="mb-3 col-12">
            <label for="goals" class="form-label">Goals</label>
            <textarea id="goals" asp-for="Goals" class="form-control" rows="2" placeholder="Describe your intention for the session" required></textarea>
        </div>
    </div>

    <div class="conversations-list">
        <h4>Conversations</h4>
        <div class="table-responsive">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>Person's Name</th>
                        <th>Duration (minutes)</th>
                        <th>Success Rating</th>
                        <th>Comment</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="conversationsTableBody">
                    <!-- Rows will be added dynamically here -->
                </tbody>
            </table>
        </div>
        <button type="button" class="btn btn-primary" onclick="addConversationRow()">+ Add Conversation</button>
    </div>

    <!-- Custom Right-Click Dropdown -->
    <div id="customMenu" class="custom-menu">
        <div class="menu-item" onclick="addConversationRow()">Add Conversation</div>
        <div class="menu-item" onclick="alert('Option 2 Selected')">Option 2</div>
        <div class="menu-item" onclick="alert('Option 3 Selected')">Option 3</div>
    </div>


    <input type="hidden" id="conversationDataInput" name="ConversationsJson" />
    <div class="session-actions d-grid gap-2 d-md-flex justify-content-md-end">
        <button type="button" class="btn btn-success mb-2" onclick="saveSession()">Save Session</button>
    </div>
</form>

<form method="post" asp-page-handler="EndSession" id="endSessionForm">
    <input type="hidden" id="conversationDataInput" name="ConversationsJson" />
    <button type="button" class="btn btn-danger mb-2" onclick="endSession()">End Session</button>
</form>

<!-- Comment Edit Modal -->
<div class="modal fade" id="commentModal" tabindex="-1" aria-labelledby="commentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="commentModalLabel">Edit Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea id="modalCommentText" class="form-control" rows="5"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveComment()">Save Comment</button>
            </div>
        </div>
    </div>
</div>

<script src="~/js/active_session.js" asp-append-version="true"></script>

